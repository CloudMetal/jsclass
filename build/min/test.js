JS.Test=new JS.Module('Test',{extend:{Unit:new JS.Module({}),asyncTimeout:10,filter:function(a,b){return JS.Test.Runner.filter(a,b)},UI:new JS.Module({}),Reporters:new JS.Module({extend:{METHODS:['startRun','startSuite','startTest','update','addFault','endTest','endSuite','endRun'],_K:{},register:function(a,b){this._K[a]=b},find:function(a){if(!a)return null;return this._K[a]||null}}}),addReporter:function(a){var b=this.reporter;if(!(a instanceof JS.Test.Reporters.Composite)){this.reporter=new JS.Test.Reporters.Composite();this.reporter.addReporter(b)}this.reporter.addReporter(a)},setReporter:function(a,b){if(this.reporter&&b!==false)return;this.reporter=a}}});JS.Test.Unit.extend({Observable:new JS.Module({addListener:function(a,b,c){if(b===undefined)throw new Error('No callback was passed as a listener');this.channels()[a]=this.channels()[a]||[];this.channels()[a].push([b,c]);return b},removeListener:function(a,b,c){var d=this.channels()[a];if(!d)return;var f=d.length;while(f--){if(d[f][0]===b){d.splice(f,1);return b}}return null},notifyListeners:function(a,b){var b=JS.array(arguments),a=b.shift(),c=this.channels()[a];if(!c)return 0;for(var d=0,f=c.length;d<f;d++)c[d][0].apply(c[d][1]||null,b);return c.length},channels:function(){return this.__channels__=this.__channels__||[]}})});JS.Test.Unit.extend({AssertionFailedError:new JS.Class(Error,{initialize:function(a){this.message=a.toString()}}),Assertions:new JS.Module({assertBlock:function(a,b,c){if(typeof a==='function'){c=b;b=a;a=null}this.__wrapAssertion__(function(){if(!b.call(c||null)){a=this.buildMessage(a||'assertBlock failed');throw new JS.Test.Unit.AssertionFailedError(a);}})},flunk:function(a){this.assertBlock(this.buildMessage(a||'Flunked'),function(){return false})},assert:function(a,b){this.__wrapAssertion__(function(){this.assertBlock(this.buildMessage(b,'<?> is not true',a),function(){return a})})},assertEqual:function(a,b,c){var d=this.buildMessage(c,'<?> expected but was\n<?>',a,b);this.assertBlock(d,function(){return JS.Enumerable.areEqual(a,b)})},assertNotEqual:function(a,b,c){var d=this.buildMessage(c,'<?> expected not to be equal to\n<?>',a,b);this.assertBlock(d,function(){return!JS.Enumerable.areEqual(a,b)})},assertNull:function(a,b){this.assertEqual(null,a,b)},assertNotNull:function(a,b){var c=this.buildMessage(b,'<?> expected not to be null',a);this.assertBlock(c,function(){return a!==null})},assertKindOf:function(c,d,f){this.__wrapAssertion__(function(){var a=(!d||typeof c==='string')?typeof d:(d.klass||d.constructor);var b=this.buildMessage(f,'<?> expected to be an instance of\n<?> but was\n<?>',d,c,a);this.assertBlock(b,function(){return JS.isType(d,c)})})},assertRespondTo:function(c,d,f){this.__wrapAssertion__(function(){var a=this.buildMessage('','<?>\ngiven as the method name argument to #assertRespondTo must be a String',d);this.assertBlock(a,function(){return typeof d==='string'});var b=c?c.constructor:typeof c;a=this.buildMessage(f,'<?>\nof type <?>\nexpected to respond to <?>',c,b,d);this.assertBlock(a,function(){return c&&c[d]!==undefined})})},assertMatch:function(b,c,d){this.__wrapAssertion__(function(){var a=this.buildMessage(d,'<?> expected to match\n<?>',c,b);this.assertBlock(a,function(){return JS.match(b,c)})})},assertNoMatch:function(b,c,d){this.__wrapAssertion__(function(){var a=this.buildMessage(d,'<?> expected not to match\n<?>',c,b);this.assertBlock(a,function(){return(typeof b.test==='function')?!b.test(c):!b.match(c)})})},assertSame:function(a,b,c){var d=this.buildMessage(c,'<?> expected to be the same as\n<?>',a,b);this.assertBlock(d,function(){return b===a})},assertNotSame:function(a,b,c){var d=this.buildMessage(c,'<?> expected not to be the same as\n<?>',a,b);this.assertBlock(d,function(){return b!==a})},assertInDelta:function(b,c,d,f){this.__wrapAssertion__(function(){this.assertKindOf('number',b);this.assertKindOf('number',c);this.assertKindOf('number',d);this.assert(d>=0,'The delta should not be negative');var a=this.buildMessage(f,'<?> and\n<?> expected to be within\n<?> of each other',b,c,d);this.assertBlock(a,function(){return Math.abs(b-c)<=d})})},assertSend:function(b,c){this.__wrapAssertion__(function(){this.assertKindOf(Array,b,'assertSend requires an array of send information');this.assert(b.length>=2,'assertSend requires at least a receiver and a message name');var a=this.buildMessage(c,'<?> expected to respond to\n<?(?)> with a true value',b[0],JS.Test.Unit.AssertionMessage.literal(b[1]),b.slice(2));this.assertBlock(a,function(){return b[0][b[1]].apply(b[0],b.slice(2))})})},__processExceptionArgs__:function(a){var a=JS.array(a),b=(typeof a[a.length-1]==='function')?null:a.pop(),c=a.pop(),d=JS.isType(a[a.length-1],'string')?a.pop():'',f=new JS.Enumerable.Collection(a);return[a,f,d,c,b]},assertThrow:function(){var d=this.__processExceptionArgs__(arguments),f=d[0],g=d[1],h=d[2],j=d[3],k=d[4];this.__wrapAssertion__(function(){var b=this.buildMessage(h,'<?> exception expected but none was thrown',f),c;this.assertBlock(b,function(){try{j.call(k)}catch(e){c=e;return true}return false});b=this.buildMessage(h,'<?> exception expected but was\n?',f,c);this.assertBlock(b,function(){return g.any(function(a){return JS.isType(c,a)||(c.name&&c.name===a.name)})})})},assertThrows:function(){return this.assertThrow.apply(this,arguments)},assertNothingThrown:function(){var a=this.__processExceptionArgs__(arguments),b=a[0],c=a[1],d=a[2],f=a[3],g=a[4];this.__wrapAssertion__(function(){try{f.call(g)}catch(e){if((b.length===0&&!JS.isType(e,JS.Test.Unit.AssertionFailedError))||c.any(function(type){return JS.isType(e,type)}))this.assertBlock(this.buildMessage(d,'Exception thrown:\n?',e),function(){return false});else throw e;}})},buildMessage:function(){var a=JS.array(arguments),b=a.shift(),c=a.shift();return new JS.Test.Unit.AssertionMessage(b,c,a)},__wrapAssertion__:function(a){if(this.__assertionWrapped__===undefined)this.__assertionWrapped__=false;if(!this.__assertionWrapped__){this.__assertionWrapped__=true;try{this.addAssertion();return a.call(this)}finally{this.__assertionWrapped__=false}}else{return a.call(this)}},addAssertion:function(){}})});JS.Test.Unit.extend({AssertionMessage:new JS.Class({extend:{Literal:new JS.Class({initialize:function(a){this._13=a;this.toString=this.inspect},inspect:function(){return this._13.toString()}}),literal:function(a){return new this.Literal(a)},Template:new JS.Class({extend:{create:function(a){var b=a?a.match(/\(\?\)|(?=[^\\])\?|(?:(?!\(\?\))(?:\\\?|[^\?]))+/g):[];return new this(b)}},initialize:function(b){this._L=new JS.Enumerable.Collection(b);this.count=this._L.findAll(function(a){return a==='?'||a==='(?)'}).length},result:function(b){if(b.length!==this.count)throw'The number of parameters does not match the number of substitutions';var c=JS.array(b);return this._L.collect(function(a){if(a==='(?)')return c.shift().replace(/^\[/,'(').replace(/\]$/,')');if(a==='?')return c.shift();return a.replace(/\\\?/g,'?')}).join('')}})},initialize:function(a,b,c){this._M=a;this._14=b;this._15=new JS.Enumerable.Collection(c)},template:function(){return this._16=this._16||this.klass.Template.create(this._14)},toString:function(){var b=[],c,d;if(this._M)b.push(this._M);d=this.template().result(this._15.collect(function(a){return JS.Console.convert(a)},this));if(d!=='')b.push(d);return b.join('\n')}})});JS.Test.Unit.extend({Failure:new JS.Class({initialize:function(a,b){this._y=a;this._17=b},metadata:function(){return{test:this.testMetadata(),error:this.errorMetadata()}},testMetadata:function(){return this._y.metadata()},errorMetadata:function(){return{type:'failure',message:this._17}}})});JS.Test.Unit.extend({Error:new JS.Class({initialize:function(a,b){this._y=a;this._b=b},metadata:function(){return{test:this.testMetadata(),error:this.errorMetadata()}},testMetadata:function(){return this._y.metadata()},errorMetadata:function(){return{type:'error',message:this._b.name+': '+this._b.message,backtrace:JS.Console.filterBacktrace(this._b.stack)}}})});JS.Test.Unit.extend({TestResult:new JS.Class({include:JS.Test.Unit.Observable,extend:{CHANGED:'Test.Unit.TestResult.CHANGED',FAULT:'Test.Unit.TestResult.FAULT'},initialize:function(){this._N=this._O=0;this._8=[];this._j=[]},addRun:function(){this._N+=1;this.notifyListeners(this.klass.CHANGED,this)},addFailure:function(a){this._8.push(a);this.notifyListeners(this.klass.FAULT,a);this.notifyListeners(this.klass.CHANGED,this)},addError:function(a){this._j.push(a);this.notifyListeners(this.klass.FAULT,a);this.notifyListeners(this.klass.CHANGED,this)},addAssertion:function(){this._O+=1;this.notifyListeners(this.klass.CHANGED,this)},passed:function(){return this._8.length===0&&this._j.length===0},runCount:function(){return this._N},assertionCount:function(){return this._O},failureCount:function(){return this._8.length},errorCount:function(){return this._j.length},metadata:function(){return{passed:this.passed(),tests:this.runCount(),assertions:this.assertionCount(),failures:this.failureCount(),errors:this.errorCount()}}})});JS.Test.Unit.extend({TestSuite:new JS.Class({include:JS.Enumerable,extend:{STARTED:'Test.Unit.TestSuite.STARTED',FINISHED:'Test.Unit.TestSuite.FINISHED',forEach:function(b,c,d,f){var g=false,h=false,j=b.length,k=-1,l=new Date().getTime(),m=this.setTimeout;var n=function(){h=true;var a=new Date().getTime();if(JS.Console.BROWSER&&(a-l)>1000){l=a;g=false;m(o,0)}else if(!g){g=true;while(g)o()}};var o=function(){k+=1;if(k===j){g=false;return d&&d.call(f||null)}h=false;c.call(f||null,b[k],n);if(!h)g=false};n()},setTimeout:(function(){return(typeof setTimeout==='undefined')?undefined:setTimeout})()},initialize:function(a){this._k=a||'Unnamed TestSuite';this._1=[]},forEach:function(a,b,c){this.klass.forEach(this._1,a,b,c)},run:function(c,d,f,g){f.call(g||null,this.klass.STARTED,this);this.forEach(function(a,b){a.run(c,b,f,g)},function(){f.call(g||null,this.klass.FINISHED,this);d.call(g||null)},this)},push:function(a){this._1.push(a);return this},remove:function(a){var b=this._1.length;while(b--){if(this._1[b]===a)this._1.splice(b,1)}},size:function(){var a=0,b=this._1.length;while(b--){a+=this._1[b].size()}return a},empty:function(){return this._1.length===0},toString:function(){return this._k}})});JS.Test.Unit.extend({TestCase:new JS.Class({include:JS.Test.Unit.Assertions,extend:[JS.Enumerable,{STARTED:'Test.Unit.TestCase.STARTED',FINISHED:'Test.Unit.TestCase.FINISHED',testCases:[],reports:[],handlers:[],clear:function(){this.testCases=[]},inherited:function(a){this.testCases.push(a)},forEach:function(a,b){for(var c=0,d=this.testCases.length;c<d;c++)a.call(b||null,this.testCases[c])},metadata:function(){var a=this._c||this.displayName,b=[],c=this.superclass;while(c!==JS.Test.Unit.TestCase){b.unshift(c._c||c.displayName);c=c.superclass}return{fullName:b.concat(a).join(' '),shortName:a,context:b}},suite:function(b,c,d){var f=this.metadata().fullName,g=new JS.Enumerable.Collection(this.instanceMethods(c)),h=g.select(function(a){return/^test./.test(a)&&this.filter(f+' '+a,b)},this).sort(),j=new JS.Test.Unit.TestSuite(this.displayName);for(var k=0,l=h.length;k<l;k++){try{j.push(new this(h[k]))}catch(e){}}if(j.empty()&&d){try{j.push(new this('defaultTest'))}catch(e){}}return j},filter:function(a,b){if(!b||b.length===0)return true;return a.indexOf(b)>=0}}],initialize:function(a){if(typeof this[a]!=='function')throw'invalid_test';this._0=a;this._2=true},run:function(a,b,c,d){c.call(d||null,this.klass.STARTED,this);this._z=a;var f=function(){this.exec('teardown',function(){this.exec(function(){JS.Test.Unit.mocking.verify()},function(){a.addRun();c.call(d||null,this.klass.FINISHED,this);b()})})};this.exec('setup',function(){this.exec(this._0,f)},f)},exec:function(b,c,d){if(!b)return c.call(this);if(!d)d=c;var f=(typeof b==='function')?b.length:this.__eigen__().instanceMethod(b).arity,g=(typeof b==='function')?b:this[b],h=null,j=false,k=false,l=this;if(f===0)return this._P(function(){g.call(this);c.call(this)},this._Q(d));var m=function(a){l.exec(function(){j=true;this._m();if(h)JS.ENV.clearTimeout(h);throw a;},c,d)};this._R(m);this._P(function(){g.call(this,function(a){k=true;l._m();if(h)JS.ENV.clearTimeout(h);if(!j)l.exec(a,c,d)})},this._Q(d));if(!k&&JS.ENV.setTimeout)h=JS.ENV.setTimeout(function(){l.exec(function(){j=true;this._m();throw new Error('Timed out after waiting '+JS.Test.asyncTimeout+' seconds for test to resume');},c,d)},JS.Test.asyncTimeout*1000)},_R:function(a,b){if(!a)return;this._m(false);if(JS.Console.NODE)process.addListener('uncaughtException',a);else if(JS.Console.BROWSER)window.onerror=a;if(b!==false)this.klass.handlers.push(a);return a},_m:function(a){var b=this.klass.handlers,c=b[b.length-1];if(!c)return;if(JS.Console.NODE)process.removeListener('uncaughtException',c);else if(JS.Console.BROWSER)window.onerror=null;if(a!==false){b.pop();this._R(b[b.length-1],false)}},_Q:function(b){return function(a){if(JS.isType(a,JS.Test.Unit.AssertionFailedError))this.addFailure(a.message);else this.addError(a);if(b)b.call(this)}},_P:function(a,b,c){try{a.call(this)}catch(e){if(b)b.call(this,e)}finally{if(c)c.call(this)}},setup:function(a){a()},teardown:function(a){a()},defaultTest:function(){return this.flunk('No tests were specified')},passed:function(){return this._2},size:function(){return 1},addAssertion:function(){this._z.addAssertion()},addFailure:function(a){this._2=false;this._z.addFailure(new JS.Test.Unit.Failure(this,a))},addError:function(a){this._2=false;this._z.addError(new JS.Test.Unit.Error(this,a))},name:function(){var a=this._0.replace(/^test\W*/ig,'');if(a.replace(this.klass.displayName,'')===a)return this._0+'('+this.klass.displayName+')';else return a},metadata:function(){var a=this._0.replace(/^test:\W*/ig,''),b=[],c=this.klass;while(c!==JS.Test.Unit.TestCase){b.unshift(c._c||c.displayName);c=c.superclass}return{fullName:b.concat(a).join(' '),shortName:a,context:b}},toString:function(){return this.name()}})});JS.Test.UI.extend({Terminal:new JS.Class({OPTIONS:{format:String,test:String},SHORTS:{'f':'--format','t':'--test'},prepare:function(a,b){a.call(b||null,this)},getOptions:function(){var a={};if(JS.Console.NODE){a=require('nopt')(this.OPTIONS,this.SHORTS);if(process.env.TAP)a.format='tap';delete a.argv}return a},getReporters:function(a){var b=[],c=JS.Test.Reporters;var d=c.find(a.format)||c.Progress;b.push(new d(a));b.push(new c.ExitStatus(a));return b}})});JS.Test.UI.extend({Browser:new JS.Class({prepare:function(a,b){var c=(window.location.hash||'').replace(/^#/,''),d=this;if(c==='testem'){JS.Package.Loader.loadFile('/testem.js',function(){a.call(b||null,d)})}else{a.call(b||null,d)}},getOptions:function(){var a=(window.location.search||'').replace(/^\?/,''),b=a.split('&'),c={},d;for(var f=0,g=b.length;f<g;f++){d=b[f].split('=');c[decodeURIComponent(d[0])]=decodeURIComponent(d[1])}return c},getReporters:function(a){var b=[],c=JS.Test.Reporters,d=new c.Browser(a);b.push(d);if(JS.ENV.TestSwarm)b.push(new c.TestSwarm(a,d));else if(JS.ENV.Testem)b.push(new c.Testem(a));else b.push(new c.Console(a));return b}})});JS.Test.Reporters.extend({Progress:new JS.Class({include:JS.Console,SYMBOLS:{failure:'F',error:'E'},NAMES:{failure:'Failure',error:'Error'},initialize:function(){this._3=[]},startRun:function(a){this.consoleFormat('bold');this.puts('Loaded suite: '+a.suites.join(', '));this.puts('');this.reset();this.puts('Started')},startSuite:function(a){},startTest:function(a){this._A=false},addFault:function(a){this._3.push(a);if(this._A)return;this._A=true;this.consoleFormat('bold','red');this.print(this.SYMBOLS[a.error.type]);this.reset()},endTest:function(a){if(this._A)return;this.consoleFormat('green');this.print('.');this.reset()},endSuite:function(a){},update:function(a){},endRun:function(a){for(var b=0,c=this._3.length;b<c;b++)this._18(b+1,this._3[b]);this.reset();this.puts('');this.puts('Finished in '+a.runtime+' seconds');this._19(a)},_18:function(a,b){this.puts('');this.consoleFormat('bold','red');this.puts('\n'+a+') '+this.NAMES[b.error.type]+': '+b.test.fullName);this.reset();this.puts(b.error.message);if(b.error.backtrace)this.puts(b.error.backtrace);this.reset()},_19:function(a){var b=a.passed?'green':'red';this.consoleFormat(b);this.puts(this._n(a.tests,'test')+', '+this._n(a.assertions,'assertion')+', '+this._n(a.failures,'failure')+', '+this._n(a.errors,'error'));this.reset();this.puts('')},_n:function(a,b){return a+' '+b+(a===1?'':'s')}})});JS.Test.Reporters.register('progress',JS.Test.Reporters.Progress);JS.Test.Reporters.extend({TAP:new JS.Class({include:JS.Console,startRun:function(a){this._B=0},startSuite:function(a){},startTest:function(a){this._2=true;this._3=[]},addFault:function(a){this._2=false;this._3.push(a)},endTest:function(a){var b=this._2?'ok':'not ok';b+=' '+ ++this._B+' '+a.fullName;this.puts(b);var c,d,f,g,h;for(var j=0,k=this._3.length;j<k;j++){c=this._3[j];var d=c.error.message;if(c.error.backtrace)d+='\n'+c.error.backtrace;f=d.split(/[\r\n]/);for(g=0,h=f.length;g<h;g++)this.puts('    '+f[g])}},endSuite:function(a){},update:function(a){},endRun:function(a){}})});JS.Test.Reporters.register('tap',JS.Test.Reporters.TAP);JS.Test.Reporters.extend({ExitStatus:new JS.Class({startRun:function(a){},startSuite:function(a){},startTest:function(a){},addFault:function(a){},endTest:function(a){},endSuite:function(a){},update:function(a){},endRun:function(a){JS.Console.exit(a.passed?0:1)}})});JS.Test.Reporters.extend({Browser:new JS.Class({initialize:function(){var f=this;this._1a=JS.DOM.div({className:'test-result-container'},function(d){d.table({className:'report'},function(c){c.thead(function(b){b.tr(function(a){a.th({scope:'col'},'Tests');a.th({scope:'col'},'Assertions');a.th({scope:'col'},'Failures');a.th({scope:'col'},'Errors')})});c.tbody(function(b){b.tr(function(a){f._1=a.td();f._1b=a.td();f._8=a.td();f._j=a.td()})})});f._S=d.div({className:'light light-pending'});d.p({className:'user-agent'},window.navigator.userAgent);f._1c=new f.klass.Context('spec',d.ul({className:'specs'}));f._1d=d.p({className:'summary'})});document.body.insertBefore(this._1a,document.body.firstChild)},_T:function(a){var b=this._1c,c=a.context;for(var d=0,f=c.length;d<f;d++)b=b.child(c[d]);return b},startRun:function(a){this.update({tests:0,assertions:0,failures:0,errors:0})},startSuite:function(a){},startTest:function(a){this._T(a).addTest(a.shortName)},addFault:function(a){this._T(a.test).child(a.test.shortName).addFault(a.error)},endTest:function(a){},endSuite:function(a){},update:function(a){this._1.innerHTML=String(a.tests);this._1b.innerHTML=String(a.assertions);this._8.innerHTML=String(a.failures);this._j.innerHTML=String(a.errors)},endRun:function(a){this.update(a);JS.DOM.removeClass(this._S,'light-pending');JS.DOM.addClass(this._S,a.passed?'light-passed':'light-failed');this._1d.innerHTML='Finished in '+a.runtime+' seconds'},serialize:function(){var a=document.getElementsByTagName('li'),b=a.length;while(b--)JS.DOM.removeClass(a[b],'closed');var a=document.getElementsByTagName('script'),b=a.length;while(b--)a[b].parentNode.removeChild(a[b]);var c=document.getElementsByTagName('html')[0];return'<!doctype html><html>'+c.innerHTML+'</html>'}})});JS.Test.Reporters.Browser.extend({Context:new JS.Class({initialize:function(f,g,h){this._5=g;this._6=f;this._k=h;this._C=[];if(h===undefined){this._D=g;return}var j=this._5._D||this._5,k={_1:'Tests',_8:'Failed'},l=this;this._o=new JS.DOM.Builder(j).li({className:this._6+' passed'},function(d){d.ul({className:'stats'},function(b){for(var c in k)b.li(function(a){a.span({className:'label'},k[c]+': ');l[c]=a.span({className:'number'},'0')})});if(h){l._p=d.p({className:l._6+'-name'},h);if(l._6==='spec'){l._q=JS.DOM.span({className:'runner'},'Run');l._q.style.background='url("'+JSCLASS_PATH+'assets/bullet_go.png") center center no-repeat';l._p.insertBefore(l._q,l._p.firstChild)}}l._D=d.ul({className:'children'})});var m=/\btest=/;if(!m.test(window.location.search))JS.DOM.addClass(this._o,'closed');JS.DOM.Event.on(this._p,'click',function(){JS.DOM.toggleClass(this._o,'closed')},this);if(this._q)JS.DOM.Event.on(this._q,'click',this.runTest,this)},ping:function(a){if(!this[a])return;this[a].innerHTML=parseInt(this[a].innerHTML)+1;if(this._5.ping)this._5.ping(a)},fail:function(){if(!this._o)return;JS.DOM.removeClass(this._o,'passed');JS.DOM.addClass(this._p,'failed');if(this._5.fail)this._5.fail()},child:function(a){return this._C[a]=this._C[a]||new this.klass('spec',this,a)},addTest:function(a){var b=this._C[a]=new this.klass('test',this,a);b.ping('_1')},addFault:function(g){var h=g.message;if(g.backtrace)h+='\n'+g.backtrace;var j=JS.DOM.li({className:'fault'},function(f){f.p(function(a){var b=h.split(/[\r\n]+/);for(var c=0,d=b.length;c<d;c++){if(c>0)a.br();a.concat(b[c])}})});this._D.appendChild(j);this.ping('_8');this.fail()},getName:function(){var a=[],b=this._5&&this._5.getName&&this._5.getName();if(b)a.push(b);a.push(this._k);return a.join(' ')},runTest:function(){window.location.search='test='+encodeURIComponent(this.getName())}})});JS.Test.Reporters.extend({Console:new JS.Class({_1e:function(a,b){if(!window.console||!window.console.log||!window.JSON)return;console.log(JSON.stringify({jstest:[a,b]}))}})});(function(){var b=JS.Test.Reporters.METHODS,c=b.length;while(c--)(function(i){var d=b[i];JS.Test.Reporters.Console.define(d,function(a){this._1e(d,a)})})(c)})();JS.Test.Reporters.extend({Testem:new JS.Class({initialize:function(){var b=this;Testem.useCustomAdapter(function(a){b._E=a})},startRun:function(a){this._U=[];this._B=0;this._E.emit('tests-start')},startSuite:function(a){},startTest:function(a){this._2=true;this._3=[]},addFault:function(a){this._2=false;this._3.push({passed:false,message:a.error.message,stacktrace:a.error.backtrace})},endTest:function(a){var b={passed:this._2?1:0,failed:this._2?0:1,total:1,id:++this._B,name:a.fullName,items:this._3};this._U.push(b);this._E.emit('test-result',b)},endSuite:function(a){},update:function(a){},endRun:function(a){this._E.emit('all-test-results',{passed:a.tests-a.failures-a.errors,failed:a.failures,total:a.tests,tests:this._U})}})});JS.Test.Reporters.extend({TestSwarm:new JS.Class({initialize:function(a,b){this._1l=b;TestSwarm.serialize=function(){return b.serialize()}},startRun:function(a){},startSuite:function(a){},startTest:function(a){},addFault:function(a){},endTest:function(a){TestSwarm.heartbeat()},endSuite:function(a){},update:function(a){},endRun:function(a){TestSwarm.submit({fail:a.failures,error:a.errors,total:a.tests})}})});JS.Test.Reporters.extend({Composite:new JS.Class({initialize:function(a){this._d=a||[]},addReporter:function(a){this._d.push(a)},removeReporter:function(a){var b=JS.indexOf(this._d,a);if(b>=0)this._d.splice(b,1)}})});(function(){var f=JS.Test.Reporters.METHODS,g=f.length;while(g--)(function(i){var h=f[i];JS.Test.Reporters.Composite.define(h,function(a){var b;for(var c=0,d=this._d.length;c<d;c++){b=this._d[c][h];if(b)b.call(this._d[c],a)}})})(g)})();JS.Test.extend({Context:new JS.Module({extend:{included:function(a){a.extend(JS.Test.Context.Context,{_e:false});a.include(JS.Test.Context.LifeCycle,{_e:false});a.extend(JS.Test.Context.Test,{_e:false});a.include(JS.Console)},Context:new JS.Module({getContextName:function(){this._c=this._c||'';return(typeof this.superclass.getContextName==='function')?(this.superclass.getContextName()+' '+this._c).replace(/^\s+/,''):this.displayName},setContextName:function(a){this._c=a},context:function(a,b){var c=new JS.Class(this,{},{_e:false});c.__eigen__().resolve();c.setContextName(a.toString());c.setName(c.getContextName());b.call(c);return c},cover:function(a){var b=new JS.Test.Coverage(a);this.before_all_callbacks.push(b.method('attach'));this.after_all_callbacks.push(b.method('detach'));JS.Test.Unit.TestCase.reports.push(b)}})}}),describe:function(a,b){var c=new JS.Class(a.toString(),JS.Test.Unit.TestCase,{},{_e:false});c.include(JS.Test.Context,{_e:false});c.__eigen__().resolve();b.call(c);return c}});JS.Test.Context.Context.alias({describe:'context'});JS.Test.extend({context:JS.Test.describe});JS.Test.Context.LifeCycle=new JS.Module({extend:{included:function(b){b.extend(this.ClassMethods);b.before_all_callbacks=[];b.before_each_callbacks=[];b.after_all_callbacks=[];b.after_each_callbacks=[];b.before_should_callbacks={};b.extend({inherited:function(a){this.callSuper();a.before_all_callbacks=[];a.before_each_callbacks=[];a.after_all_callbacks=[];a.after_each_callbacks=[];a.before_should_callbacks={}}})},ClassMethods:new JS.Module({before:function(a,b){if((typeof a==='function')||!b){b=a;a='each'}this['before_'+(a+'_')+'callbacks'].push(b)},after:function(a,b){if((typeof a==='function')||!b){b=a;a='each'}this['after_'+(a+'_')+'callbacks'].push(b)},gatherCallbacks:function(a,b){var c=(typeof this.superclass.gatherCallbacks==='function')?this.superclass.gatherCallbacks(a,b):[];var d=this[a+'_'+(b+'_')+'callbacks'];return(a==='before')?c.concat(d):d.concat(c)}})},setup:function(a){var b=this;this.callSuper(function(){if(b.klass.before_should_callbacks[b._0])b.klass.before_should_callbacks[b._0].call(b);b.runCallbacks('before','each',a)})},teardown:function(a){var b=this;this.callSuper(function(){b.runCallbacks('after','each',a)})},runCallbacks:function(c,d,f){var g=this.klass.gatherCallbacks(c,d);JS.Test.Unit.TestSuite.forEach(g,function(a,b){this.exec(a,b)},f,this)},runAllCallbacks:function(d,f,g){var h=this.instanceVariables();this.runCallbacks(d,'all',function(){var c=this.instanceVariables().inject({},function(a,b){if(h.member(b))return a;a[b]=this[b];return a},this);if(f)f.call(g||null,c)})},setValuesFromCallbacks:function(a){for(var b in a)this[b]=a[b]},instanceVariables:function(){var a=[];for(var b in this){if(this.hasOwnProperty(b))a.push(b)}return new JS.Enumerable.Collection(a)}});(function(){var a=JS.Test.Context.LifeCycle.ClassMethods.method('instanceMethod');JS.Test.Context.LifeCycle.ClassMethods.include({setup:a('before'),teardown:a('after')})})();JS.Test.Context.extend({SharedBehavior:new JS.Class(JS.Module,{extend:{createFromBehavior:function(a){var b=new this();b._1f=a;return b},moduleName:function(c){return c.toLowerCase().replace(/[\s:',\.~;!#=\(\)&]+/g,'_').replace(/\/(.?)/g,function(a,b){return'.'+b.toUpperCase()}).replace(/(?:^|_)(.)/g,function(a,b){return b.toUpperCase()})}},included:function(a){this._1f.call(a)}})});JS.Test.Unit.TestCase.extend({shared:function(a,b){a=JS.Test.Context.SharedBehavior.moduleName(a);JS.ENV[a]=JS.Test.Context.SharedBehavior.createFromBehavior(b)},use:function(a){if(JS.isType(a,JS.Test.Context.SharedBehavior)||JS.isType(a,JS.Module))this.include(a);else if(JS.isType(a,'string')){var b=JS.Test.Context.SharedBehavior.moduleName(a),c=JS.ENV[b];if(!c)throw new Error('Could not find example group named "'+a+'"');this.include(c)}}});(function(){var g=function(a,b){var c={};for(var d=0,f=b.length;d<f;d++)c[b[d]]=JS.Test.Unit.TestCase[a];JS.Test.Unit.TestCase.extend(c)};g('shared',['sharedBehavior','shareAs','shareBehaviorAs','sharedExamplesFor']);g('use',['uses','itShouldBehaveLike','behavesLike','usesExamplesFrom'])})();JS.Test.Context.Test=new JS.Module({test:function(a,b,c){var d='test: '+a;if(JS.indexOf(this.instanceMethods(false),d)>=0)throw new Error(d+' is already defined in '+this.displayName);b=b||{};if(typeof b==='function'){c=b}else{if(b.before!==undefined)this.before_should_callbacks[d]=b.before}this.define(d,c,{_e:false})},beforeTest:function(a,b){this.test(a,{before:b},function(){})}});JS.Test.Context.Test.alias({it:'test',should:'test',tests:'test',beforeIt:'beforeTest',beforeShould:'beforeTest',beforeTests:'beforeTest'});(function(){var b=JS.Test.Unit.TestCase.suite;JS.Test.Unit.TestCase.extend({suite:function(a){return b.call(this,a,false,false)}})})();JS.Test.Unit.TestSuite.include({run:function(d,f,g,h){g.call(h||null,this.klass.STARTED,this._k);var j=function(c){this.forEach(function(a,b){if(c)a.setValuesFromCallbacks(c);a.run(d,b,g,h)},function(){var a=function(){g.call(h||null,this.klass.FINISHED,this._k);f()};if(c)k.runAllCallbacks('after',a,this);else a.call(this)},this)};var k=this._1[0],l=null;if(k&&k.runAllCallbacks)k.runAllCallbacks('before',j,this);else j.call(this,null)}});JS.Test.extend({Mocking:new JS.Module({extend:{ExpectationError:new JS.Class(JS.Test.Unit.AssertionFailedError),UnexpectedCallError:new JS.Class(Error,{initialize:function(a){this.message=a.toString()}}),__activeStubs__:[],stub:function(a,b,c){var d=false;if(a==='new'){a=b;b=c;c=undefined;d=true}if(JS.isType(a,'string')){c=b;b=a;a=JS.ENV}var f=this.__activeStubs__,g=f.length;while(g--){if(f[g]._9===a&&f[g]._0===b)return f[g].defaultMatcher(c)}var h=new JS.Test.Mocking.Stub(a,b,d);f.push(h);return h.defaultMatcher(c)},removeStubs:function(){var a=this.__activeStubs__,b=a.length;while(b--)a[b].revoke();this.__activeStubs__=[]},verify:function(){try{var a=this.__activeStubs__;for(var b=0,c=a.length;b<c;b++)a[b]._1g()}finally{this.removeStubs()}},Stub:new JS.Class({initialize:function(a,b,c){this._9=a;this._0=b;this._r=c;this._f=a[b];this._1h=a.hasOwnProperty?a.hasOwnProperty(b):(typeof this._f!=='undefined');var d=JS.Test.Mocking;this._s=[];this._g=new d.Parameters([new d.AnyArgs()]);this._7=false;this.apply()},defaultMatcher:function(a){if(a!==undefined&&typeof a!=='function'){this._9[this._0]=a;return this}this._V();this._4=this._g;if(typeof a==='function')this._4._W=a;return this},apply:function(){var a=this._9,b=this._0;if(a[b]!==this._f)return;var c=this;this._X=function(){return c._1i(this,arguments)};a[b]=this._X},revoke:function(){if(this._1h)this._9[this._0]=this._f;else try{delete this._9[this._0]}catch(e){this._9[this._0]=undefined}},expected:function(){this._7=true;this._g._7=true},_V:function(){if(this._4)this._4._Y=true},_1i:function(a,b){this._V();var c=this._s.concat(this._g),d,f,g;if(this._r&&!(a instanceof this._X)){g=new JS.Test.Unit.AssertionMessage('','<?> expected to be a constructor but called without `new`',[this._f]);throw new JS.Test.Mocking.UnexpectedCallError(g);}this._g.ping();for(var h=0,j=c.length;h<j;h++){d=c[h];f=d.match(b);if(!f)continue;if(d!==this._g)d.ping();if(f.fake)return f.fake.apply(a,b);if(f.exception)throw f.exception;if(f.hasOwnProperty('callback')){if(!f.callback)continue;f.callback.apply(f.context,d.nextYieldArgs())}if(f)return d.nextReturnValue()}if(this._r){g=new JS.Test.Unit.AssertionMessage('','<?> constructed with unexpected arguments:\n(?)',[this._f,JS.array(b)])}else{g=new JS.Test.Unit.AssertionMessage('','<?> received call to '+this._0+'() with unexpected arguments:\n(?)',[a,JS.array(b)])}throw new JS.Test.Mocking.UnexpectedCallError(g);},_1g:function(){if(!this._7)return;for(var a=0,b=this._s.length;a<b;a++)this._Z(this._s[a]);this._Z(this._g)},_Z:function(a){var b=this._r?this._f:this._9;a.verify(b,this._0,this._r)}})}})});JS.Test.Mocking.extend({Parameters:new JS.Class({initialize:function(a,b){this._10=JS.array(a);this._7=b;this._Y=false;this._h=0},toArray:function(){var a=this._10.slice();if(this._i)a.push(new JS.Test.Mocking.InstanceOf(Function));return a},returns:function(a){this._F=0;this._G=a},nextReturnValue:function(){if(!this._G)return undefined;var a=this._G[this._F];this._F=(this._F+1)%this._G.length;return a},yields:function(a){this._H=0;this._i=a},nextYieldArgs:function(){if(!this._i)return undefined;var a=this._i[this._H];this._H=(this._H+1)%this._i.length;return a},setMinimum:function(a){this._7=true;this._I=a},setMaximum:function(a){this._7=true;this._t=a},setExpected:function(a){this._7=true;this._u=a},match:function(a){if(!this._Y)return false;var b=JS.array(a),c,d;if(this._i){if(typeof b[b.length-2]==='function'){d=b.pop();c=b.pop()}else if(typeof b[b.length-1]==='function'){d=null;c=b.pop()}}if(!JS.Enumerable.areEqual(this._10,b))return false;var f={};if(this._b){f.exception=this._b}if(this._i){f.callback=c;f.context=d}if(this._W){f.fake=this._W}return f},ping:function(){this._h+=1},verify:function(a,b,c){if(!this._7)return;var d=true,f;if(this._h===0&&this._t===undefined&&this._u===undefined){d=false}else if(this._u!==undefined&&this._h!==this._u){f=this._J('exactly');d=false}else if(this._t!==undefined&&this._h>this._t){f=this._J('at most');d=false}else if(this._I!==undefined&&this._h<this._I){f=this._J('at least');d=false}if(d)return;var g;if(c){g=new JS.Test.Unit.AssertionMessage('Mock expectation not met','<?> expected to be constructed with\n(?)'+(f?'\n'+f:''),[a,this.toArray()])}else{g=new JS.Test.Unit.AssertionMessage('Mock expectation not met','<?> expected to receive call\n'+b+'(?)'+(f?'\n'+f:''),[a,this.toArray()])}throw new JS.Test.Mocking.ExpectationError(g);},_J:function(a){var b=this._h,c='but '+b+' call'+(b===1?' was':'s were')+' made';var d={'exactly':this._u,'at most':this._t,'at least':this._I};return a+' '+d[a]+' times\n'+c}})});JS.Test.Mocking.extend({Anything:new JS.Class({equals:function(){return true},toString:function(){return'anything'}}),AnyArgs:new JS.Class({equals:function(){return JS.Enumerable.ALL_EQUAL},toString:function(){return'*arguments'}}),ArrayIncluding:new JS.Class({initialize:function(a){this._a=Array.prototype.slice.call(a)},equals:function(a){if(!JS.isType(a,Array))return false;var b=this._a.length,c;loop:while(b--){c=a.length;while(c--){if(JS.Enumerable.areEqual(this._a[b],a[c]))continue loop}return false}return true},toString:function(){var a=JS.Console.convert(this._a);return'arrayIncluding('+a+')'}}),ObjectIncluding:new JS.Class({initialize:function(a){this._a=a},equals:function(a){if(!JS.isType(a,Object))return false;for(var b in this._a){if(!JS.Enumerable.areEqual(this._a[b],a[b]))return false}return true},toString:function(){var a=JS.Console.convert(this._a);return'objectIncluding('+a+')'}}),InstanceOf:new JS.Class({initialize:function(a){this._6=a},equals:function(a){return JS.isType(a,this._6)},toString:function(){var a=JS.Console.convert(this._6),b=/^[aeiou]/i.test(a)?'an':'a';return b+'('+a+')'}}),Matcher:new JS.Class({initialize:function(a){this._6=a},equals:function(a){return JS.match(this._6,a)},toString:function(){var a=JS.Console.convert(this._6);return'matching('+a+')'}})});JS.Test.Mocking.Stub.include({given:function(){var a=new JS.Test.Mocking.Parameters(arguments,this._7);this._s.push(a);this._4=a;return this},raises:function(a){this._4._b=a;return this},returns:function(){this._4.returns(arguments);return this},yields:function(){this._4.yields(arguments);return this},atLeast:function(a){this._4.setMinimum(a);return this},atMost:function(a){this._4.setMaximum(a);return this},exactly:function(a){this._4.setExpected(a);return this}});JS.Test.Mocking.Stub.alias({raising:'raises',returning:'returns',yielding:'yields'});JS.Test.Mocking.extend({DSL:new JS.Module({stub:function(){return JS.Test.Mocking.stub.apply(JS.Test.Mocking,arguments)},expect:function(){var a=JS.Test.Mocking.stub.apply(JS.Test.Mocking,arguments);a.expected();this.addAssertion();return a},anything:function(){return new JS.Test.Mocking.Anything()},anyArgs:function(){return new JS.Test.Mocking.AnyArgs()},instanceOf:function(a){return new JS.Test.Mocking.InstanceOf(a)},match:function(a){return new JS.Test.Mocking.Matcher(a)},arrayIncluding:function(){return new JS.Test.Mocking.ArrayIncluding(arguments)},objectIncluding:function(a){return new JS.Test.Mocking.ObjectIncluding(a)}})});JS.Test.Unit.TestCase.include(JS.Test.Mocking.DSL);JS.Test.Unit.mocking=JS.Test.Mocking;JS.Test.extend({AsyncSteps:new JS.Class(JS.Module,{define:function(b,c){this.callSuper(b,function(){var a=[b,c].concat(JS.array(arguments));this.__enqueue__(a)})},included:function(d){d.include(JS.Test.AsyncSteps.Sync);if(!d.includes(JS.Test.Context))return;d.after(function(a){this.sync(a)});d.extend({after:function(b,c){if((typeof b==='function')||!c){c=b;b='each'}this.callSuper(function(a){this.sync(function(){this.exec(c,a)})})}})},extend:{Sync:new JS.Module({__enqueue__:function(a){this.__stepQueue__=this.__stepQueue__||[];this.__stepQueue__.push(a);if(this.__runningSteps__)return;this.__runningSteps__=true;var b=JS.Test.Unit.TestSuite.setTimeout;b(this.method('__runNextStep__'),1)},__runNextStep__:function(){var a=this.__stepQueue__.shift(),b;if(!a){this.__runningSteps__=false;if(!this.__stepCallbacks__)return;b=this.__stepCallbacks__.length;while(b--)this.__stepCallbacks__.shift().call(this);return}var c=a.shift(),d=a.shift(),f=a.slice(),g=function(){d.apply(this,f)};f[d.length-1]=this.method('__runNextStep__');if(!this.exec)return g.call(this);this.exec(g,function(){},this.method('__endSteps__'))},__endSteps__:function(){this.__stepQueue__=[];this.__runNextStep__()},addError:function(){this.callSuper();this.__endSteps__()},sync:function(a){if(!this.__runningSteps__)return a.call(this);this.__stepCallbacks__=this.__stepCallbacks__||[];this.__stepCallbacks__.push(a)}})}}),asyncSteps:function(a){return new this.AsyncSteps(a)}});JS.Test.extend({FakeClock:new JS.Module({extend:{API:new JS.Singleton({stub:function(){var a=JS.Test.Mocking,b=['Date','setTimeout','clearTimeout','setInterval','clearInterval'],c=b.length;JS.Test.FakeClock.reset();while(c--)a.stub(b[c],JS.Test.FakeClock.method(b[c]));Date.now=function(){return new Date()}},reset:function(){return JS.Test.FakeClock.reset()},tick:function(a){return JS.Test.FakeClock.tick(a)}}),JSDate:Date,Schedule:new JS.Class(JS.SortedSet,{nextScheduledAt:function(b){return this.find(function(a){return a.time<=b})}}),Timeout:new JS.Class({include:JS.Comparable,initialize:function(a,b,c){this.callback=a;this.interval=b;this.repeat=c},compareTo:function(a){return this.time-a.time},toString:function(){return(this.repeat?'Interval':'Timeout')+'('+this.interval+'):'+this.time}}),reset:function(){this._v=new Date().getTime();this._w=this._v;this._l=new this.Schedule()},tick:function(a){this._v+=a;var b;while(b=this._l.nextScheduledAt(this._v))this._1j(b);this._w=this._v},_1j:function(a){this._w=a.time;a.callback();if(a.repeat){a.time+=a.interval;this._l.rebuild()}else{this.clearTimeout(a)}},_11:function(a,b,c){var d=new this.Timeout(a,b,c);d.time=this._w+b;this._l.add(d);return d},Date:function(){var a=new this.JSDate();a.setTime(this._w);return a},setTimeout:function(a,b){return this._11(a,b,false)},setInterval:function(a,b){return this._11(a,b,true)},clearTimeout:function(a){this._l.remove(a)},clearInterval:function(a){this._l.remove(a)}}})});JS.Test.FakeClock.include({clock:JS.Test.FakeClock.API});JS.Test.extend({Coverage:new JS.Class({initialize:function(d){this._12=d;this._x=new JS.Hash([]);var f=function(a){var b=a.instanceMethods(false),c=b.length;while(c--)this._x.store(a.instanceMethod(b[c]),0)};f.call(this,d);f.call(this,d.__eigen__())},attach:function(){var a=this._12;JS.StackTrace.addObserver(this);JS.Method.trace([a,a.__eigen__()])},detach:function(){var a=this._12;JS.Method.untrace([a,a.__eigen__()]);JS.StackTrace.removeObserver(this)},update:function(a,b){if(a!=='call')return;var c=this._x.assoc(b.method);if(c)c.setValue(c.value+1)},report:function(){var c=this._x.entries().sort(function(a,b){return b.value-a.value});var d=this._x.all(function(a){return a.value>0});JS.Console.printTable(c,function(a,b){if(a[1]===0)return['bgred','white'];return(b%2===0)?['bold']:[]});return d}})});JS.Test.extend({Helpers:new JS.Module({$R:function(a,b){return new JS.Range(a,b)},$w:function(a){return a.split(/\s+/)},forEach:function(a,b,c){for(var d=0,f=a.length;d<f;d++){b.call(c||null,a[d],d)}},its:function(){return new JS.MethodChain()},map:function(a,b,c){return new JS.Enumerable.Collection(a).map(b,c)},repeat:function(a,b,c){while(a--)b.call(c)}})});JS.Test.extend({Runner:new JS.Class({initialize:function(a){this._1k=(typeof a==='string')?{format:a}:(a||{})},run:function(){var a=this.getUI(this._1k);a.prepare(this.start,this)},start:function(d){var f=d.getOptions(),g=d.getReporters(f),h=this.getSuite(f);JS.Test.setReporter(new JS.Test.Reporters.Composite(g),false);var j=new Date().getTime();testResult=new JS.Test.Unit.TestResult(),TR=JS.Test.Unit.TestResult,TS=JS.Test.Unit.TestSuite,TC=JS.Test.Unit.TestCase;var k=testResult.addListener(TR.CHANGED,function(){var a=testResult.metadata(),b=new Date().getTime();a.runtime=(b-j)/1000;JS.Test.reporter.update(a)});var l=testResult.addListener(TR.FAULT,function(a){JS.Test.reporter.addFault(a.metadata())});var m=function(){testResult.removeListener(TR.CHANGED,k);testResult.removeListener(TR.FAULT,l);var a=new Date().getTime(),b=(a-j)/1000;var c=testResult.metadata();c.runtime=b;JS.Test.reporter.endRun(c)};var n=function(a,b){if(a===TS.STARTED)JS.Test.reporter.startSuite();else if(a===TC.STARTED)JS.Test.reporter.startTest(b.metadata());else if(a===TC.FINISHED)JS.Test.reporter.endTest(b.metadata());else if(a===TS.FINISHED)JS.Test.reporter.endSuite()};JS.Test.reporter.startRun({suites:h.toString()});h.run(testResult,m,n,this)},getUI:function(a){if(JS.Console.BROWSER)return new JS.Test.UI.Browser(a);else return new JS.Test.UI.Terminal(a)},getSuite:function(c){var d=c.test,f=[],g=[];JS.Test.Unit.TestCase.resolve();JS.Test.Unit.TestCase.forEach(function(a){var b=a.suite(d);if(b.size()>0)g.push(b);if(a.superclass===JS.Test.Unit.TestCase)f.push(a.displayName)});var h=new JS.Test.Unit.TestSuite(f);for(var j=0,k=g.length;j<k;j++)h.push(g[j]);JS.Test.Unit.TestCase.clear();return h},extend:{filter:function(a,b){var c=[],d=[],f=c.length,g,h;if(f===0)return a;while(f--){g=a.length;while(g--){h=a[g].replace(new RegExp(b+'$'),'');if(c[f].substr(0,h.length)===h)d.push(a[g])}}return d}}}),autorun:function(a){var b=new JS.Test.Runner(a);b.run()}});
//@ sourceMappingURL=test.js.map